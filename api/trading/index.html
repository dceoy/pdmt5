<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="dceoy">
        <link rel="canonical" href="https://github.com/dceoy/pdmt5/api/trading/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Trading - pdmt5 API Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">pdmt5 API Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../mt5/" class="dropdown-item">MetaTrader5</a>
</li>
                                    
<li>
    <a href="../dataframe/" class="dropdown-item">DataFrame</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Trading</a>
</li>
                                    
<li>
    <a href="../utils/" class="dropdown-item">Utilities</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../dataframe/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../utils/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/dceoy/pdmt5/edit/master/docs/api/trading.md" class="nav-link">Edit on dceoy/pdmt5
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#trading" class="nav-link">Trading</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#pdmt5.trading" class="nav-link">trading</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#classes" class="nav-link">Classes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pdmt5.trading.Mt5TradingClient" class="nav-link">Mt5TradingClient</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pdmt5.trading.Mt5TradingError" class="nav-link">Mt5TradingError</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#usage-examples" class="nav-link">Usage Examples</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#position-management-features" class="nav-link">Position Management Features</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dry-run-mode" class="nav-link">Dry Run Mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#return-values" class="nav-link">Return Values</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#best-practices" class="nav-link">Best Practices</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#common-return-codes" class="nav-link">Common Return Codes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#margin-calculation-methods" class="nav-link">Margin Calculation Methods</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#market-order-placement" class="nav-link">Market Order Placement</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#stop-loss-and-take-profit-management" class="nav-link">Stop Loss and Take Profit Management</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#market-data-and-analysis-methods" class="nav-link">Market Data and Analysis Methods</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#integration-with-mt5dataclient" class="nav-link">Integration with Mt5DataClient</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="trading">Trading<a class="headerlink" href="#trading" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<h2 id="pdmt5.trading" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">pdmt5.trading</span>


<a href="#pdmt5.trading" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Trading operations module with advanced MetaTrader5 functionality.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="pdmt5.trading.Mt5TradingClient" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Mt5TradingClient</span>


<a href="#pdmt5.trading.Mt5TradingClient" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Mt5DataClient (pdmt5.dataframe.Mt5DataClient)" href="../dataframe/#pdmt5.dataframe.Mt5DataClient">Mt5DataClient</a></code></p>



        <p>MetaTrader5 trading client with advanced trading operations.</p>
<p>This class extends Mt5DataClient to provide specialized trading functionality
including position management, order analysis, and trading performance metrics.</p>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="pdmt5.trading.Mt5TradingClient.model_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">model_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#pdmt5.trading.Mt5TradingClient.model_config" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">model_config</span> <span class="o">=</span> <span class="n"><span title="pydantic.ConfigDict">ConfigDict</span></span><span class="p">(</span><span class="n"><span title="pydantic.ConfigDict(frozen)">frozen</span></span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="pdmt5.trading.Mt5TradingClient.mt5_failed_trade_retcodes" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">mt5_failed_trade_retcodes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#pdmt5.trading.Mt5TradingClient.mt5_failed_trade_retcodes" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">mt5_failed_trade_retcodes</span><span class="p">:</span> <span class="n"><span title="set">set</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set of failed trade return codes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of failed trade return codes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="pdmt5.trading.Mt5TradingClient.mt5_successful_trade_retcodes" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">mt5_successful_trade_retcodes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#pdmt5.trading.Mt5TradingClient.mt5_successful_trade_retcodes" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">mt5_successful_trade_retcodes</span><span class="p">:</span> <span class="n"><span title="set">set</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set of successful trade return codes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of successful trade return codes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.calculate_minimum_order_margin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_minimum_order_margin</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_minimum_order_margin" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_minimum_order_margin</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">order_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="float">float</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the minimum order margins for a given symbol.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the minimum order margins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional side of the order, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with minimum volume and margin for the specified order side.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_minimum_order_margin</span><span class="p">(</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the minimum order margins for a given symbol.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        symbol: Symbol for which to calculate the minimum order margins.</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        order_side: Optional side of the order, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        Dictionary with minimum volume and margin for the specified order side.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="n">symbol_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">action</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_TYPE_</span><span class="si">{</span><span class="n">order_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">volume</span><span class="o">=</span><span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;volume_min&quot;</span><span class="p">],</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">price</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">]</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="k">if</span> <span class="n">order_side</span> <span class="o">==</span> <span class="s2">&quot;SELL&quot;</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="k">else</span> <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">]</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="p">),</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;volume_min&quot;</span><span class="p">],</span> <span class="s2">&quot;margin&quot;</span><span class="p">:</span> <span class="n">margin</span><span class="p">}</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">if</span> <span class="n">margin</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="s2">&quot;Calculated minimum </span><span class="si">%s</span><span class="s2"> order margin for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="s2">&quot;Calculated minimum order margin to </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.calculate_new_position_margin_ratio" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_new_position_margin_ratio</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_new_position_margin_ratio" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_new_position_margin_ratio</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">new_position_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_position_volume</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="float">float</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the margin ratio for a new position.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the margin ratio.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_position_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Side of the new position, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_position_volume</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Volume of the new position.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Margin ratio for the new position as a fraction of account equity.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_new_position_margin_ratio</span><span class="p">(</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>    <span class="n">new_position_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="n">new_position_volume</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the margin ratio for a new position.</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        symbol: Symbol for which to calculate the margin ratio.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        new_position_side: Side of the new position, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">        new_position_volume: Volume of the new position.</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        float: Margin ratio for the new position as a fraction of account equity.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="n">account_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_info_as_dict</span><span class="p">()</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">account_info</span><span class="p">[</span><span class="s2">&quot;equity&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">positions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_positions_with_metrics_as_df</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">current_signed_margin</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="n">positions_df</span><span class="p">[</span><span class="s2">&quot;signed_margin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">size</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">new_position_side</span> <span class="ow">and</span> <span class="n">new_position_volume</span><span class="p">):</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="k">elif</span> <span class="n">new_position_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BUY&quot;</span><span class="p">:</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_BUY</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="n">volume</span><span class="o">=</span><span class="n">new_position_volume</span><span class="p">,</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="p">)</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="k">elif</span> <span class="n">new_position_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SELL&quot;</span><span class="p">:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_SELL</span><span class="p">,</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                <span class="n">volume</span><span class="o">=</span><span class="n">new_position_volume</span><span class="p">,</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">],</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="p">(</span><span class="n">new_signed_margin</span> <span class="o">+</span> <span class="n">current_signed_margin</span><span class="p">)</span> <span class="o">/</span> <span class="n">account_info</span><span class="p">[</span><span class="s2">&quot;equity&quot;</span><span class="p">]</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="s2">&quot;Calculated new position margin ratio for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.calculate_spread_ratio" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_spread_ratio</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_spread_ratio" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_spread_ratio</span><span class="p">(</span><span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="float">float</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the spread ratio for a given symbol.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the spread ratio.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spread ratio as a float.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_spread_ratio</span><span class="p">(</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the spread ratio for a given symbol.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        symbol: Symbol for which to calculate the spread ratio.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Spread ratio as a float.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="p">(</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">])</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="o">/</span> <span class="p">(</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">])</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculated spread ratio for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.calculate_volume_by_margin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_volume_by_margin</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_volume_by_margin" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_volume_by_margin</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">margin</span><span class="p">:</span> <span class="n"><span title="float">float</span></span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="float">float</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate volume based on margin for a given symbol and order side.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the volume.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>margin</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Margin amount to use for the calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Side of the order, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Calculated volume as a float.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_volume_by_margin</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">margin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate volume based on margin for a given symbol and order side.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        symbol: Symbol for which to calculate the volume.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        margin: Margin amount to use for the calculation.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        order_side: Side of the order, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        Calculated volume as a float.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">min_order_margin_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_minimum_order_margin</span><span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">order_side</span><span class="o">=</span><span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">if</span> <span class="n">min_order_margin_dict</span><span class="p">[</span><span class="s2">&quot;margin&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="n">floor</span><span class="p">(</span><span class="n">margin</span> <span class="o">/</span> <span class="n">min_order_margin_dict</span><span class="p">[</span><span class="s2">&quot;margin&quot;</span><span class="p">])</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="o">*</span> <span class="n">min_order_margin_dict</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="s2">&quot;Calculated volume by margin to </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.close_open_positions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">close_open_positions</span>


<a href="#pdmt5.trading.Mt5TradingClient.close_open_positions" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbols</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">|</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="o">|</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close all open positions for specified symbols.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbols</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | <span title="tuple">tuple</span>[<span title="str">str</span>, ...] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional symbol or list of symbols to filter positions.
If None, all symbols will be considered.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_filling_mode</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;IOC&#39;, &#39;FOK&#39;, &#39;RETURN&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order filling mode, either "IOC", "FOK", or "RETURN".</p>
              </div>
            </td>
            <td>
                  <code>&#39;IOC&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only check the order without sending it.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for request parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with symbols as keys and lists of dictionaries containing
operation results for each closed position as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="nf">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Close all open positions for specified symbols.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        symbols: Optional symbol or list of symbols to filter positions.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            If None, all symbols will be considered.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        order_filling_mode: Order filling mode, either &quot;IOC&quot;, &quot;FOK&quot;, or &quot;RETURN&quot;.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        dry_run: If True, only check the order without sending it.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        **kwargs: Additional keyword arguments for request parameters.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        Dictionary with symbols as keys and lists of dictionaries containing</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            operation results for each closed position as values.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">symbol_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">]</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">symbol_list</span> <span class="o">=</span> <span class="n">symbols</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">symbol_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols_get</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching and closing positions for symbols: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">symbol_list</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">s</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_close_position</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">order_filling_mode</span><span class="o">=</span><span class="n">order_filling_mode</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbol_list</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.collect_entry_deals_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collect_entry_deals_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.collect_entry_deals_as_df" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">collect_entry_deals_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">history_seconds</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;ticket&quot;</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Collect entry deals as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to collect entry deals for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>history_seconds</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time range in seconds to fetch deals around the last tick.</p>
              </div>
            </td>
            <td>
                  <code>3600</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_keys</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional index keys for the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ticket&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Entry deals with time index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_entry_deals_as_df</span><span class="p">(</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">history_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;ticket&quot;</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect entry deals as a DataFrame.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        symbol: Symbol to collect entry deals for.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        history_seconds: Time range in seconds to fetch deals around the last tick.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        index_keys: Optional index keys for the DataFrame.</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        pd.DataFrame: Entry deals with time index.</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">last_tick_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="n">deals_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_deals_get_as_df</span><span class="p">(</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">date_from</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">history_seconds</span><span class="p">)),</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">date_to</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">history_seconds</span><span class="p">)),</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="n">index_keys</span><span class="p">,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>    <span class="p">)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">if</span> <span class="n">deals_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">deals_df</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">deals_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="o">&amp;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">DEAL_TYPE_BUY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">DEAL_TYPE_SELL</span><span class="p">})</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="p">]</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="s2">&quot;Collected entry deals for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.fetch_latest_rates_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fetch_latest_rates_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.fetch_latest_rates_as_df" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fetch_latest_rates_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">granularity</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="s2">&quot;M1&quot;</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">count</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">1440</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch rate (OHLC) data as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to fetch data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granularity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time granularity as a timeframe suffix (e.g., "M1", "H1").</p>
              </div>
            </td>
            <td>
                  <code>&#39;M1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bars to fetch.</p>
              </div>
            </td>
            <td>
                  <code>1440</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_keys</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional index keys for the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>&#39;time&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: OHLC data with time index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Mt5TradingError (pdmt5.trading.Mt5TradingError)" href="#pdmt5.trading.Mt5TradingError">Mt5TradingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the granularity is not supported by MetaTrader5.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_latest_rates_as_df</span><span class="p">(</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="n">granularity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;M1&quot;</span><span class="p">,</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1440</span><span class="p">,</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch rate (OHLC) data as a DataFrame.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        symbol: Symbol to fetch data for.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        granularity: Time granularity as a timeframe suffix (e.g., &quot;M1&quot;, &quot;H1&quot;).</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">        count: Number of bars to fetch.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        index_keys: Optional index keys for the DataFrame.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        pd.DataFrame: OHLC data with time index.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        Mt5TradingError: If the granularity is not supported by MetaTrader5.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">timeframe</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TIMEFRAME_</span><span class="si">{</span><span class="n">granularity</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="sa">f</span><span class="s2">&quot;MetaTrader5 does not support the given granularity: </span><span class="si">{</span><span class="n">granularity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="k">raise</span> <span class="n">Mt5TradingError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_rates_from_pos_as_df</span><span class="p">(</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">timeframe</span><span class="o">=</span><span class="n">timeframe</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">start_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">index_keys</span><span class="o">=</span><span class="n">index_keys</span><span class="p">,</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="s2">&quot;Fetched latest </span><span class="si">%s</span><span class="s2"> rates for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="n">granularity</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.fetch_latest_ticks_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fetch_latest_ticks_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.fetch_latest_ticks_as_df" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fetch_latest_ticks_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">seconds</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time_msc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch tick data as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to fetch tick data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seconds</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time range in seconds to fetch ticks around the last tick time.</p>
              </div>
            </td>
            <td>
                  <code>300</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_keys</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional index keys for the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_msc&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Tick data with time index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_latest_ticks_as_df</span><span class="p">(</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time_msc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch tick data as a DataFrame.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        symbol: Symbol to fetch tick data for.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        seconds: Time range in seconds to fetch ticks around the last tick time.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">        index_keys: Optional index keys for the DataFrame.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        pd.DataFrame: Tick data with time index.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="n">last_tick_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_ticks_range_as_df</span><span class="p">(</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">date_from</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">)),</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="n">date_to</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">)),</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">COPY_TICKS_ALL</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="n">index_keys</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="s2">&quot;Fetched latest ticks for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.fetch_positions_with_metrics_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fetch_positions_with_metrics_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.fetch_positions_with_metrics_as_df" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fetch_positions_with_metrics_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch open positions as a DataFrame with additional metrics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to fetch positions for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame containing open positions with additional metrics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_positions_with_metrics_as_df</span><span class="p">(</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch open positions as a DataFrame with additional metrics.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        symbol: Symbol to fetch positions for.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        pd.DataFrame: DataFrame containing open positions with additional metrics.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_get_as_df</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="k">if</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">positions_df</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">ask_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_BUY</span><span class="p">,</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="n">volume</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">bid_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_SELL</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="n">volume</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">],</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="p">)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="n">positions_df</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                <span class="n">elapsed_seconds</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>                    <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>                <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                <span class="n">underlier_increase_ratio</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;price_current&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;price_open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="p">),</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                <span class="n">buy</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">POSITION_TYPE_BUY</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="n">sell</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">POSITION_TYPE_SELL</span><span class="p">,</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                <span class="n">buy_i</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;buy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="n">sell_i</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sell&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">sign</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;buy_i&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sell_i&quot;</span><span class="p">],</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="n">margin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;buy_i&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ask_margin</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sell_i&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bid_margin</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                    <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="p">),</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="p">)</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="n">signed_volume</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">],</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                <span class="n">signed_margin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;margin&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">],</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="n">underlier_profit_ratio</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;underlier_increase_ratio&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">]</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="p">),</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;buy_i&quot;</span><span class="p">,</span> <span class="s2">&quot;sell_i&quot;</span><span class="p">,</span> <span class="s2">&quot;sign&quot;</span><span class="p">,</span> <span class="s2">&quot;underlier_increase_ratio&quot;</span><span class="p">])</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="s2">&quot;Fetched positions with metrics for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.place_market_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">place_market_order</span>


<a href="#pdmt5.trading.Mt5TradingClient.place_market_order" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">place_market_order</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">volume</span><span class="p">:</span> <span class="n"><span title="float">float</span></span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">order_time_mode</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        <span class="s2">&quot;GTC&quot;</span><span class="p">,</span> <span class="s2">&quot;DAY&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED_DAY&quot;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GTC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Send or check an order request to place a market order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for the order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>volume</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Volume of the order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Side of the order, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_filling_mode</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;IOC&#39;, &#39;FOK&#39;, &#39;RETURN&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order filling mode, either "IOC", "FOK", or "RETURN".</p>
              </div>
            </td>
            <td>
                  <code>&#39;IOC&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_time_mode</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;GTC&#39;, &#39;DAY&#39;, &#39;SPECIFIED&#39;, &#39;SPECIFIED_DAY&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order time mode, either "GTC", "DAY", "SPECIFIED",
or "SPECIFIED_DAY".</p>
              </div>
            </td>
            <td>
                  <code>&#39;GTC&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_error</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raise an error on operation failure.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only check the order without sending it.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for request parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with operation result.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="k">def</span><span class="w"> </span><span class="nf">place_market_order</span><span class="p">(</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">volume</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="n">order_time_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;GTC&quot;</span><span class="p">,</span> <span class="s2">&quot;DAY&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED_DAY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GTC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Send or check an order request to place a market order.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        symbol: Symbol for the order.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        volume: Volume of the order.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        order_side: Side of the order, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        order_filling_mode: Order filling mode, either &quot;IOC&quot;, &quot;FOK&quot;, or &quot;RETURN&quot;.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        order_time_mode: Order time mode, either &quot;GTC&quot;, &quot;DAY&quot;, &quot;SPECIFIED&quot;,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            or &quot;SPECIFIED_DAY&quot;.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        raise_on_error: If True, raise an error on operation failure.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        dry_run: If True, only check the order without sending it.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        **kwargs: Additional keyword arguments for request parameters.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        Dictionary with operation result.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Placing market order: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">order_side</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_or_check_order</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">request</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">TRADE_ACTION_DEAL</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">volume</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_TYPE_</span><span class="si">{</span><span class="n">order_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="s2">&quot;type_filling&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_FILLING_</span><span class="si">{</span><span class="n">order_filling_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="p">),</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="s2">&quot;type_time&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_TIME_</span><span class="si">{</span><span class="n">order_time_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="p">},</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="pdmt5.trading.Mt5TradingClient.update_sltp_for_open_positions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_sltp_for_open_positions</span>


<a href="#pdmt5.trading.Mt5TradingClient.update_sltp_for_open_positions" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update_sltp_for_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">stop_loss</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">take_profit</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">tickets</span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Change Stop Loss and Take Profit for open positions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for the position.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Stop Loss price. If None, it will not be changed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>take_profit</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Take Profit price. If None, it will not be changed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tickets</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of position tickets to filter positions. If None, all open
positions for the symbol will be considered.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_error</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raise an error on operation failure.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only check the order without sending it.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for request parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dictionaries with operation results for each updated position.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_sltp_for_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">stop_loss</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">take_profit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">tickets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Change Stop Loss and Take Profit for open positions.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        symbol: Symbol for the position.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        stop_loss: New Stop Loss price. If None, it will not be changed.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        take_profit: New Take Profit price. If None, it will not be changed.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        tickets: List of position tickets to filter positions. If None, all open</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">            positions for the symbol will be considered.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        raise_on_error: If True, raise an error on operation failure.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        dry_run: If True, only check the order without sending it.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        **kwargs: Additional keyword arguments for request parameters.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        List of dictionaries with operation results for each updated position.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_get_as_df</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="k">if</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No open positions found for symbol: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">elif</span> <span class="n">tickets</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">filtered_positions_df</span> <span class="o">=</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ticket&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickets</span><span class="p">)]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">filtered_positions_df</span> <span class="o">=</span> <span class="n">positions_df</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">if</span> <span class="n">filtered_positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="s2">&quot;No open positions found for symbol: </span><span class="si">%s</span><span class="s2"> with specified tickets: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">tickets</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">symbol_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">sl</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">stop_loss</span><span class="p">,</span> <span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;digits&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">stop_loss</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">tp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">take_profit</span><span class="p">,</span> <span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;digits&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">take_profit</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">order_requests</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="p">{</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">TRADE_ACTION_SLTP</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;symbol&quot;</span><span class="p">],</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;ticket&quot;</span><span class="p">],</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="s2">&quot;sl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">sl</span> <span class="ow">or</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sl&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="s2">&quot;tp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">tp</span> <span class="ow">or</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="p">}</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">filtered_positions_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="k">if</span> <span class="n">sl</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sl&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">tp</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="p">]</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">if</span> <span class="n">order_requests</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="s2">&quot;Updating SL/TP for </span><span class="si">%d</span><span class="s2"> positions for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="nb">len</span><span class="p">(</span><span class="n">order_requests</span><span class="p">),</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="n">sl</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="n">tp</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="p">)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_send_or_check_order</span><span class="p">(</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                    <span class="n">request</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">order_requests</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="s2">&quot;No positions to update for symbol: </span><span class="si">%s</span><span class="s2"> with SL: </span><span class="si">%s</span><span class="s2"> and TP: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="n">sl</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="n">tp</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="pdmt5.trading.Mt5TradingError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Mt5TradingError</span>


<a href="#pdmt5.trading.Mt5TradingError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Mt5RuntimeError (pdmt5.mt5.Mt5RuntimeError)" href="../mt5/#pdmt5.mt5.Mt5RuntimeError">Mt5RuntimeError</a></code></p>



        <p>MetaTrader5 trading error.</p>









    </div>

</div>




  </div>

    </div>

</div><h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The trading module extends Mt5DataClient with advanced trading operations including position management, order execution, and dry run support for testing trading strategies without actual execution.</p>
<h2 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h2>
<h3 id="mt5tradingclient">Mt5TradingClient<a class="headerlink" href="#mt5tradingclient" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<h2 id="pdmt5.trading.Mt5TradingClient" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">pdmt5.trading.Mt5TradingClient</span>


<a href="#pdmt5.trading.Mt5TradingClient" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Mt5DataClient (pdmt5.dataframe.Mt5DataClient)" href="../dataframe/#pdmt5.dataframe.Mt5DataClient">Mt5DataClient</a></code></p>



        <p>MetaTrader5 trading client with advanced trading operations.</p>
<p>This class extends Mt5DataClient to provide specialized trading functionality
including position management, order analysis, and trading performance metrics.</p>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pdmt5.trading.Mt5TradingClient.model_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">model_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#pdmt5.trading.Mt5TradingClient.model_config" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">model_config</span> <span class="o">=</span> <span class="n"><span title="pydantic.ConfigDict">ConfigDict</span></span><span class="p">(</span><span class="n"><span title="pydantic.ConfigDict(frozen)">frozen</span></span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pdmt5.trading.Mt5TradingClient.mt5_failed_trade_retcodes" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">mt5_failed_trade_retcodes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#pdmt5.trading.Mt5TradingClient.mt5_failed_trade_retcodes" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">mt5_failed_trade_retcodes</span><span class="p">:</span> <span class="n"><span title="set">set</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set of failed trade return codes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of failed trade return codes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pdmt5.trading.Mt5TradingClient.mt5_successful_trade_retcodes" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">mt5_successful_trade_retcodes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#pdmt5.trading.Mt5TradingClient.mt5_successful_trade_retcodes" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">mt5_successful_trade_retcodes</span><span class="p">:</span> <span class="n"><span title="set">set</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set of successful trade return codes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of successful trade return codes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.calculate_minimum_order_margin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_minimum_order_margin</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_minimum_order_margin" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_minimum_order_margin</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">order_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="float">float</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the minimum order margins for a given symbol.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the minimum order margins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional side of the order, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with minimum volume and margin for the specified order side.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_minimum_order_margin</span><span class="p">(</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the minimum order margins for a given symbol.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        symbol: Symbol for which to calculate the minimum order margins.</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        order_side: Optional side of the order, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        Dictionary with minimum volume and margin for the specified order side.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="n">symbol_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">action</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_TYPE_</span><span class="si">{</span><span class="n">order_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">volume</span><span class="o">=</span><span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;volume_min&quot;</span><span class="p">],</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">price</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">]</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="k">if</span> <span class="n">order_side</span> <span class="o">==</span> <span class="s2">&quot;SELL&quot;</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="k">else</span> <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">]</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="p">),</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;volume_min&quot;</span><span class="p">],</span> <span class="s2">&quot;margin&quot;</span><span class="p">:</span> <span class="n">margin</span><span class="p">}</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">if</span> <span class="n">margin</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="s2">&quot;Calculated minimum </span><span class="si">%s</span><span class="s2"> order margin for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="s2">&quot;Calculated minimum order margin to </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.calculate_new_position_margin_ratio" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_new_position_margin_ratio</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_new_position_margin_ratio" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_new_position_margin_ratio</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">new_position_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_position_volume</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="float">float</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the margin ratio for a new position.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the margin ratio.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_position_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Side of the new position, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_position_volume</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Volume of the new position.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Margin ratio for the new position as a fraction of account equity.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_new_position_margin_ratio</span><span class="p">(</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>    <span class="n">new_position_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="n">new_position_volume</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the margin ratio for a new position.</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        symbol: Symbol for which to calculate the margin ratio.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        new_position_side: Side of the new position, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">        new_position_volume: Volume of the new position.</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        float: Margin ratio for the new position as a fraction of account equity.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="n">account_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_info_as_dict</span><span class="p">()</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">account_info</span><span class="p">[</span><span class="s2">&quot;equity&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">positions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_positions_with_metrics_as_df</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">current_signed_margin</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="n">positions_df</span><span class="p">[</span><span class="s2">&quot;signed_margin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">size</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">new_position_side</span> <span class="ow">and</span> <span class="n">new_position_volume</span><span class="p">):</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="k">elif</span> <span class="n">new_position_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BUY&quot;</span><span class="p">:</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_BUY</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="n">volume</span><span class="o">=</span><span class="n">new_position_volume</span><span class="p">,</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="p">)</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="k">elif</span> <span class="n">new_position_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SELL&quot;</span><span class="p">:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_SELL</span><span class="p">,</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>                <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                <span class="n">volume</span><span class="o">=</span><span class="n">new_position_volume</span><span class="p">,</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">],</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="n">new_signed_margin</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="p">(</span><span class="n">new_signed_margin</span> <span class="o">+</span> <span class="n">current_signed_margin</span><span class="p">)</span> <span class="o">/</span> <span class="n">account_info</span><span class="p">[</span><span class="s2">&quot;equity&quot;</span><span class="p">]</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="s2">&quot;Calculated new position margin ratio for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.calculate_spread_ratio" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_spread_ratio</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_spread_ratio" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_spread_ratio</span><span class="p">(</span><span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="float">float</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the spread ratio for a given symbol.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the spread ratio.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spread ratio as a float.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_spread_ratio</span><span class="p">(</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the spread ratio for a given symbol.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        symbol: Symbol for which to calculate the spread ratio.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Spread ratio as a float.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="p">(</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">])</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="o">/</span> <span class="p">(</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">])</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculated spread ratio for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.calculate_volume_by_margin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_volume_by_margin</span>


<a href="#pdmt5.trading.Mt5TradingClient.calculate_volume_by_margin" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_volume_by_margin</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">margin</span><span class="p">:</span> <span class="n"><span title="float">float</span></span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="float">float</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate volume based on margin for a given symbol and order side.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for which to calculate the volume.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>margin</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Margin amount to use for the calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Side of the order, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Calculated volume as a float.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_volume_by_margin</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">margin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate volume based on margin for a given symbol and order side.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        symbol: Symbol for which to calculate the volume.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        margin: Margin amount to use for the calculation.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        order_side: Side of the order, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        Calculated volume as a float.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">min_order_margin_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_minimum_order_margin</span><span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">order_side</span><span class="o">=</span><span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">if</span> <span class="n">min_order_margin_dict</span><span class="p">[</span><span class="s2">&quot;margin&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="n">floor</span><span class="p">(</span><span class="n">margin</span> <span class="o">/</span> <span class="n">min_order_margin_dict</span><span class="p">[</span><span class="s2">&quot;margin&quot;</span><span class="p">])</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="o">*</span> <span class="n">min_order_margin_dict</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="s2">&quot;Calculated volume by margin to </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="n">order_side</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.close_open_positions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">close_open_positions</span>


<a href="#pdmt5.trading.Mt5TradingClient.close_open_positions" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbols</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">|</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="o">|</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close all open positions for specified symbols.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbols</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | <span title="tuple">tuple</span>[<span title="str">str</span>, ...] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional symbol or list of symbols to filter positions.
If None, all symbols will be considered.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_filling_mode</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;IOC&#39;, &#39;FOK&#39;, &#39;RETURN&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order filling mode, either "IOC", "FOK", or "RETURN".</p>
              </div>
            </td>
            <td>
                  <code>&#39;IOC&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only check the order without sending it.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for request parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with symbols as keys and lists of dictionaries containing
operation results for each closed position as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="nf">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Close all open positions for specified symbols.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        symbols: Optional symbol or list of symbols to filter positions.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            If None, all symbols will be considered.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        order_filling_mode: Order filling mode, either &quot;IOC&quot;, &quot;FOK&quot;, or &quot;RETURN&quot;.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        dry_run: If True, only check the order without sending it.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        **kwargs: Additional keyword arguments for request parameters.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        Dictionary with symbols as keys and lists of dictionaries containing</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            operation results for each closed position as values.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">symbol_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">]</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">symbol_list</span> <span class="o">=</span> <span class="n">symbols</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">symbol_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols_get</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching and closing positions for symbols: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">symbol_list</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">s</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_and_close_position</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">order_filling_mode</span><span class="o">=</span><span class="n">order_filling_mode</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbol_list</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.collect_entry_deals_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collect_entry_deals_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.collect_entry_deals_as_df" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">collect_entry_deals_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">history_seconds</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;ticket&quot;</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Collect entry deals as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to collect entry deals for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>history_seconds</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time range in seconds to fetch deals around the last tick.</p>
              </div>
            </td>
            <td>
                  <code>3600</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_keys</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional index keys for the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ticket&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Entry deals with time index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_entry_deals_as_df</span><span class="p">(</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">history_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;ticket&quot;</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect entry deals as a DataFrame.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        symbol: Symbol to collect entry deals for.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        history_seconds: Time range in seconds to fetch deals around the last tick.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        index_keys: Optional index keys for the DataFrame.</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        pd.DataFrame: Entry deals with time index.</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">last_tick_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="n">deals_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_deals_get_as_df</span><span class="p">(</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">date_from</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">history_seconds</span><span class="p">)),</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">date_to</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">history_seconds</span><span class="p">)),</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="n">index_keys</span><span class="p">,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>    <span class="p">)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">if</span> <span class="n">deals_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">deals_df</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">deals_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="o">&amp;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">DEAL_TYPE_BUY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">DEAL_TYPE_SELL</span><span class="p">})</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="p">]</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="s2">&quot;Collected entry deals for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.fetch_latest_rates_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fetch_latest_rates_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.fetch_latest_rates_as_df" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fetch_latest_rates_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">granularity</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="s2">&quot;M1&quot;</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">count</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">1440</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch rate (OHLC) data as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to fetch data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>granularity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time granularity as a timeframe suffix (e.g., "M1", "H1").</p>
              </div>
            </td>
            <td>
                  <code>&#39;M1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bars to fetch.</p>
              </div>
            </td>
            <td>
                  <code>1440</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_keys</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional index keys for the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>&#39;time&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: OHLC data with time index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Mt5TradingError (pdmt5.trading.Mt5TradingError)" href="#pdmt5.trading.Mt5TradingError">Mt5TradingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the granularity is not supported by MetaTrader5.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_latest_rates_as_df</span><span class="p">(</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="n">granularity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;M1&quot;</span><span class="p">,</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1440</span><span class="p">,</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch rate (OHLC) data as a DataFrame.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        symbol: Symbol to fetch data for.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        granularity: Time granularity as a timeframe suffix (e.g., &quot;M1&quot;, &quot;H1&quot;).</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">        count: Number of bars to fetch.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        index_keys: Optional index keys for the DataFrame.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        pd.DataFrame: OHLC data with time index.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        Mt5TradingError: If the granularity is not supported by MetaTrader5.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">timeframe</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TIMEFRAME_</span><span class="si">{</span><span class="n">granularity</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="sa">f</span><span class="s2">&quot;MetaTrader5 does not support the given granularity: </span><span class="si">{</span><span class="n">granularity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="k">raise</span> <span class="n">Mt5TradingError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_rates_from_pos_as_df</span><span class="p">(</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">timeframe</span><span class="o">=</span><span class="n">timeframe</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">start_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">index_keys</span><span class="o">=</span><span class="n">index_keys</span><span class="p">,</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="s2">&quot;Fetched latest </span><span class="si">%s</span><span class="s2"> rates for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="n">granularity</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.fetch_latest_ticks_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fetch_latest_ticks_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.fetch_latest_ticks_as_df" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fetch_latest_ticks_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">seconds</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time_msc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch tick data as a DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to fetch tick data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seconds</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time range in seconds to fetch ticks around the last tick time.</p>
              </div>
            </td>
            <td>
                  <code>300</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_keys</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional index keys for the DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>&#39;time_msc&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Tick data with time index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_latest_ticks_as_df</span><span class="p">(</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">index_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;time_msc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch tick data as a DataFrame.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        symbol: Symbol to fetch tick data for.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        seconds: Time range in seconds to fetch ticks around the last tick time.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">        index_keys: Optional index keys for the DataFrame.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        pd.DataFrame: Tick data with time index.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="n">last_tick_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_ticks_range_as_df</span><span class="p">(</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">date_from</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">)),</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="n">date_to</span><span class="o">=</span><span class="p">(</span><span class="n">last_tick_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">)),</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">COPY_TICKS_ALL</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="n">index_keys</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="s2">&quot;Fetched latest ticks for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.fetch_positions_with_metrics_as_df" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fetch_positions_with_metrics_as_df</span>


<a href="#pdmt5.trading.Mt5TradingClient.fetch_positions_with_metrics_as_df" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fetch_positions_with_metrics_as_df</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch open positions as a DataFrame with additional metrics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol to fetch positions for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame containing open positions with additional metrics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_positions_with_metrics_as_df</span><span class="p">(</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch open positions as a DataFrame with additional metrics.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        symbol: Symbol to fetch positions for.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        pd.DataFrame: DataFrame containing open positions with additional metrics.</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_get_as_df</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="k">if</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">positions_df</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">symbol_info_tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_tick_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">ask_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_BUY</span><span class="p">,</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="n">volume</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">],</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">bid_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_calc_margin</span><span class="p">(</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">ORDER_TYPE_SELL</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="n">volume</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="n">price</span><span class="o">=</span><span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">],</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="p">)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="n">positions_df</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                <span class="n">elapsed_seconds</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>                    <span class="n">symbol_info_tick</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>                <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                <span class="n">underlier_increase_ratio</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;price_current&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;price_open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="p">),</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                <span class="n">buy</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">POSITION_TYPE_BUY</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="n">sell</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">POSITION_TYPE_SELL</span><span class="p">,</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                <span class="n">buy_i</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;buy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="n">sell_i</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sell&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">sign</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;buy_i&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sell_i&quot;</span><span class="p">],</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="n">margin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;buy_i&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ask_margin</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sell_i&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">bid_margin</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                    <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="p">),</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="p">)</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="n">signed_volume</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">],</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                <span class="n">signed_margin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;margin&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">],</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="n">underlier_profit_ratio</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;underlier_increase_ratio&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sign&quot;</span><span class="p">]</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="p">),</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;buy_i&quot;</span><span class="p">,</span> <span class="s2">&quot;sell_i&quot;</span><span class="p">,</span> <span class="s2">&quot;sign&quot;</span><span class="p">,</span> <span class="s2">&quot;underlier_increase_ratio&quot;</span><span class="p">])</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="s2">&quot;Fetched positions with metrics for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.place_market_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">place_market_order</span>


<a href="#pdmt5.trading.Mt5TradingClient.place_market_order" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">place_market_order</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">volume</span><span class="p">:</span> <span class="n"><span title="float">float</span></span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">order_time_mode</span><span class="p">:</span> <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        <span class="s2">&quot;GTC&quot;</span><span class="p">,</span> <span class="s2">&quot;DAY&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED_DAY&quot;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GTC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Send or check an order request to place a market order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for the order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>volume</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Volume of the order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_side</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;BUY&#39;, &#39;SELL&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Side of the order, either "BUY" or "SELL".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_filling_mode</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;IOC&#39;, &#39;FOK&#39;, &#39;RETURN&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order filling mode, either "IOC", "FOK", or "RETURN".</p>
              </div>
            </td>
            <td>
                  <code>&#39;IOC&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_time_mode</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;GTC&#39;, &#39;DAY&#39;, &#39;SPECIFIED&#39;, &#39;SPECIFIED_DAY&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Order time mode, either "GTC", "DAY", "SPECIFIED",
or "SPECIFIED_DAY".</p>
              </div>
            </td>
            <td>
                  <code>&#39;GTC&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_error</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raise an error on operation failure.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only check the order without sending it.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for request parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with operation result.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="k">def</span><span class="w"> </span><span class="nf">place_market_order</span><span class="p">(</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">volume</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">order_side</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">],</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">order_filling_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;IOC&quot;</span><span class="p">,</span> <span class="s2">&quot;FOK&quot;</span><span class="p">,</span> <span class="s2">&quot;RETURN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IOC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="n">order_time_mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;GTC&quot;</span><span class="p">,</span> <span class="s2">&quot;DAY&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECIFIED_DAY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GTC&quot;</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Send or check an order request to place a market order.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        symbol: Symbol for the order.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        volume: Volume of the order.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        order_side: Side of the order, either &quot;BUY&quot; or &quot;SELL&quot;.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        order_filling_mode: Order filling mode, either &quot;IOC&quot;, &quot;FOK&quot;, or &quot;RETURN&quot;.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        order_time_mode: Order time mode, either &quot;GTC&quot;, &quot;DAY&quot;, &quot;SPECIFIED&quot;,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            or &quot;SPECIFIED_DAY&quot;.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        raise_on_error: If True, raise an error on operation failure.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        dry_run: If True, only check the order without sending it.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        **kwargs: Additional keyword arguments for request parameters.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        Dictionary with operation result.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Placing market order: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">order_side</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_or_check_order</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">request</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">TRADE_ACTION_DEAL</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">volume</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_TYPE_</span><span class="si">{</span><span class="n">order_side</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="s2">&quot;type_filling&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_FILLING_</span><span class="si">{</span><span class="n">order_filling_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="p">),</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="s2">&quot;type_time&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ORDER_TIME_</span><span class="si">{</span><span class="n">order_time_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="p">},</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pdmt5.trading.Mt5TradingClient.update_sltp_for_open_positions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_sltp_for_open_positions</span>


<a href="#pdmt5.trading.Mt5TradingClient.update_sltp_for_open_positions" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update_sltp_for_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">stop_loss</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">take_profit</span><span class="p">:</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">tickets</span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Change Stop Loss and Take Profit for open positions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>symbol</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol for the position.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stop_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Stop Loss price. If None, it will not be changed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>take_profit</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Take Profit price. If None, it will not be changed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tickets</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of position tickets to filter positions. If None, all open
positions for the symbol will be considered.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_on_error</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raise an error on operation failure.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only check the order without sending it.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for request parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dictionaries with operation results for each updated position.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pdmt5/trading.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_sltp_for_open_positions</span><span class="p">(</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">stop_loss</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">take_profit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">tickets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># noqa: ANN401</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Change Stop Loss and Take Profit for open positions.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        symbol: Symbol for the position.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        stop_loss: New Stop Loss price. If None, it will not be changed.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        take_profit: New Take Profit price. If None, it will not be changed.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        tickets: List of position tickets to filter positions. If None, all open</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">            positions for the symbol will be considered.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        raise_on_error: If True, raise an error on operation failure.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        dry_run: If True, only check the order without sending it.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        **kwargs: Additional keyword arguments for request parameters.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        List of dictionaries with operation results for each updated position.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_get_as_df</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="k">if</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No open positions found for symbol: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">elif</span> <span class="n">tickets</span><span class="p">:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">filtered_positions_df</span> <span class="o">=</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ticket&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickets</span><span class="p">)]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">filtered_positions_df</span> <span class="o">=</span> <span class="n">positions_df</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">if</span> <span class="n">filtered_positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="s2">&quot;No open positions found for symbol: </span><span class="si">%s</span><span class="s2"> with specified tickets: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">tickets</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">symbol_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_info_as_dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">sl</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">stop_loss</span><span class="p">,</span> <span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;digits&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">stop_loss</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">tp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">take_profit</span><span class="p">,</span> <span class="n">symbol_info</span><span class="p">[</span><span class="s2">&quot;digits&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">take_profit</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">order_requests</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="p">{</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mt5</span><span class="o">.</span><span class="n">TRADE_ACTION_SLTP</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;symbol&quot;</span><span class="p">],</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;ticket&quot;</span><span class="p">],</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="s2">&quot;sl&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">sl</span> <span class="ow">or</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sl&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="s2">&quot;tp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">tp</span> <span class="ow">or</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="p">}</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">filtered_positions_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="k">if</span> <span class="n">sl</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sl&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">tp</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="p">]</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">if</span> <span class="n">order_requests</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="s2">&quot;Updating SL/TP for </span><span class="si">%d</span><span class="s2"> positions for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="nb">len</span><span class="p">(</span><span class="n">order_requests</span><span class="p">),</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="n">sl</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="n">tp</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="p">)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_send_or_check_order</span><span class="p">(</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                    <span class="n">request</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">order_requests</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="s2">&quot;No positions to update for symbol: </span><span class="si">%s</span><span class="s2"> with SL: </span><span class="si">%s</span><span class="s2"> and TP: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                <span class="n">symbol</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="n">sl</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="n">tp</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_bases: false</p>
<p>Advanced trading client class that inherits from <code>Mt5DataClient</code> and provides specialized trading functionality.</p>
<h3 id="mt5tradingerror">Mt5TradingError<a class="headerlink" href="#mt5tradingerror" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<h2 id="pdmt5.trading.Mt5TradingError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">pdmt5.trading.Mt5TradingError</span>


<a href="#pdmt5.trading.Mt5TradingError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Mt5RuntimeError (pdmt5.mt5.Mt5RuntimeError)" href="../mt5/#pdmt5.mt5.Mt5RuntimeError">Mt5RuntimeError</a></code></p>



        <p>MetaTrader5 trading error.</p>









    </div>

</div><p>options:
show_bases: false</p>
<p>Custom runtime exception for trading-specific errors.</p>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="basic-trading-operations">Basic Trading Operations<a class="headerlink" href="#basic-trading-operations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">MetaTrader5</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mt5</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pdmt5</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mt5TradingClient</span><span class="p">,</span> <span class="n">Mt5Config</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Create configuration</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">config</span> <span class="o">=</span> <span class="n">Mt5Config</span><span class="p">(</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">login</span><span class="o">=</span><span class="mi">123456</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;your_password&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">server</span><span class="o">=</span><span class="s2">&quot;broker_server&quot;</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">portable</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c1"># Create client with dry run mode for testing</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">client</span> <span class="o">=</span> <span class="n">Mt5TradingClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># Use as context manager</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="c1"># Get current positions as DataFrame</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_positions_as_df</span><span class="p">()</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Open positions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">positions_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="c1"># Close positions for specific symbol</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Closed positions: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="production-trading">Production Trading<a class="headerlink" href="#production-trading" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Create client for live trading (dry_run=False)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">client</span> <span class="o">=</span> <span class="n">Mt5TradingClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="c1"># Close all positions for multiple symbols</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">([</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span> <span class="s2">&quot;GBPUSD&quot;</span><span class="p">,</span> <span class="s2">&quot;USDJPY&quot;</span><span class="p">])</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="c1"># Close all positions (all symbols)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">all_results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">()</span>
</code></pre></div>
<h3 id="order-filling-modes">Order Filling Modes<a class="headerlink" href="#order-filling-modes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">with</span> <span class="n">Mt5TradingClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="c1"># Use IOC (Immediate or Cancel) - default</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">results_ioc</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        <span class="n">order_filling_mode</span><span class="o">=</span><span class="s2">&quot;IOC&quot;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="c1"># Use FOK (Fill or Kill)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="n">results_fok</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;GBPUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="n">order_filling_mode</span><span class="o">=</span><span class="s2">&quot;FOK&quot;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="p">)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="c1"># Use RETURN (Return if not filled)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">results_return</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;USDJPY&quot;</span><span class="p">,</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="n">order_filling_mode</span><span class="o">=</span><span class="s2">&quot;RETURN&quot;</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="p">)</span>
</code></pre></div>
<h3 id="custom-order-parameters">Custom Order Parameters<a class="headerlink" href="#custom-order-parameters" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="c1"># Close positions with custom parameters and order filling mode</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="n">order_filling_mode</span><span class="o">=</span><span class="s2">&quot;IOC&quot;</span><span class="p">,</span>  <span class="c1"># Specify per method call</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Closing all EURUSD positions&quot;</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="n">deviation</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Maximum price deviation</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="p">)</span>
</code></pre></div>
<h3 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pdmt5.trading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mt5TradingError</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="k">except</span> <span class="n">Mt5TradingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trading error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="c1"># Handle specific trading errors</span>
</code></pre></div>
<h3 id="checking-order-status">Checking Order Status<a class="headerlink" href="#checking-order-status" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="c1"># Check order (note: send_or_check_order is an internal method)</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="c1"># For trading operations, use the provided methods like close_open_positions</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="c1"># Example: Check if we can close a position</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">positions</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_positions_as_df</span><span class="p">()</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">positions</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="c1"># Close specific position</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="position-management-features">Position Management Features<a class="headerlink" href="#position-management-features" title="Permanent link">&para;</a></h2>
<p>The Mt5TradingClient provides intelligent position management:</p>
<ul>
<li><strong>Automatic Position Reversal</strong>: Automatically determines the correct order type to close positions</li>
<li><strong>Batch Operations</strong>: Close multiple positions for one or more symbols</li>
<li><strong>Dry Run Support</strong>: Test trading logic without executing real trades</li>
<li><strong>Flexible Filtering</strong>: Close positions by symbol, group, or all positions</li>
<li><strong>Custom Parameters</strong>: Support for additional order parameters like comment, deviation, etc.</li>
</ul>
<h2 id="dry-run-mode">Dry Run Mode<a class="headerlink" href="#dry-run-mode" title="Permanent link">&para;</a></h2>
<p>Dry run mode is essential for testing trading strategies:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Test mode - validates orders without execution</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">test_client</span> <span class="o">=</span> <span class="n">Mt5TradingClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># Production mode - executes real orders</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">prod_client</span> <span class="o">=</span> <span class="n">Mt5TradingClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p>In dry run mode:</p>
<ul>
<li>Orders are validated using <code>order_check()</code> instead of <code>order_send()</code></li>
<li>No actual trades are executed</li>
<li>Full validation of margin requirements and order parameters</li>
<li>Same return structure as live trading for easy testing</li>
</ul>
<h2 id="return-values">Return Values<a class="headerlink" href="#return-values" title="Permanent link">&para;</a></h2>
<p>The <code>close_open_positions()</code> method returns a dictionary with symbols as keys:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="s2">&quot;EURUSD&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        <span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>            <span class="s2">&quot;retcode&quot;</span><span class="p">:</span> <span class="mi">10009</span><span class="p">,</span>  <span class="c1"># Trade done</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>            <span class="s2">&quot;deal&quot;</span><span class="p">:</span> <span class="mi">123456</span><span class="p">,</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>            <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="mi">789012</span><span class="p">,</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>            <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mf">1.1000</span><span class="p">,</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Request executed&quot;</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>            <span class="o">...</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="p">}</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="p">],</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="s2">&quot;GBPUSD&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">}</span>
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Always use dry run mode first</strong> to test your trading logic</li>
<li><strong>Handle Mt5TradingError exceptions</strong> for proper error management</li>
<li><strong>Check return codes</strong> to verify successful execution</li>
<li><strong>Use context managers</strong> for automatic connection handling</li>
<li><strong>Log trading operations</strong> for audit trails</li>
<li><strong>Validate positions exist</strong> before attempting to close them</li>
<li><strong>Consider market hours</strong> and trading session times</li>
</ol>
<h2 id="common-return-codes">Common Return Codes<a class="headerlink" href="#common-return-codes" title="Permanent link">&para;</a></h2>
<ul>
<li><code>TRADE_RETCODE_DONE</code> (10009): Trade operation completed successfully</li>
<li><code>TRADE_RETCODE_TRADE_DISABLED</code>: Trading disabled for the account</li>
<li><code>TRADE_RETCODE_MARKET_CLOSED</code>: Market is closed</li>
<li><code>TRADE_RETCODE_NO_MONEY</code>: Insufficient funds</li>
<li><code>TRADE_RETCODE_INVALID_VOLUME</code>: Invalid trade volume</li>
</ul>
<h2 id="margin-calculation-methods">Margin Calculation Methods<a class="headerlink" href="#margin-calculation-methods" title="Permanent link">&para;</a></h2>
<p>The trading client provides advanced margin calculation capabilities:</p>
<h3 id="calculate-minimum-order-margin">Calculate Minimum Order Margin<a class="headerlink" href="#calculate-minimum-order-margin" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="c1"># Calculate minimum margin required for BUY order</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">min_margin_buy</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_minimum_order_margin</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span> <span class="s2">&quot;BUY&quot;</span><span class="p">)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum volume: </span><span class="si">{</span><span class="n">min_margin_buy</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum margin: </span><span class="si">{</span><span class="n">min_margin_buy</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="c1"># Calculate minimum margin required for SELL order</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">min_margin_sell</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_minimum_order_margin</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="calculate-volume-by-margin">Calculate Volume by Margin<a class="headerlink" href="#calculate-volume-by-margin" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="c1"># Calculate maximum volume for given margin amount</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">available_margin</span> <span class="o">=</span> <span class="mf">1000.0</span>  <span class="c1"># USD</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">max_volume_buy</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_volume_by_margin</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span> <span class="n">available_margin</span><span class="p">,</span> <span class="s2">&quot;BUY&quot;</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">max_volume_sell</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_volume_by_margin</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span> <span class="n">available_margin</span><span class="p">,</span> <span class="s2">&quot;SELL&quot;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max BUY volume for $</span><span class="si">{</span><span class="n">available_margin</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">max_volume_buy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max SELL volume for $</span><span class="si">{</span><span class="n">available_margin</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">max_volume_sell</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="calculate-new-position-margin-ratio">Calculate New Position Margin Ratio<a class="headerlink" href="#calculate-new-position-margin-ratio" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="c1"># Calculate margin ratio for potential new position</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">margin_ratio</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_new_position_margin_ratio</span><span class="p">(</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>        <span class="n">new_position_side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="n">new_position_volume</span><span class="o">=</span><span class="mf">1.0</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New position would use </span><span class="si">{</span><span class="n">margin_ratio</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of account equity&quot;</span><span class="p">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="c1"># Check if adding position would exceed risk limits</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    <span class="k">if</span> <span class="n">margin_ratio</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># 10% risk limit</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position size too large for risk management&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="market-order-placement">Market Order Placement<a class="headerlink" href="#market-order-placement" title="Permanent link">&para;</a></h2>
<p>Place market orders with flexible configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="c1"># Place a BUY market order</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">place_market_order</span><span class="p">(</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        <span class="n">volume</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="n">order_side</span><span class="o">=</span><span class="s2">&quot;BUY&quot;</span><span class="p">,</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        <span class="n">order_filling_mode</span><span class="o">=</span><span class="s2">&quot;IOC&quot;</span><span class="p">,</span>  <span class="c1"># Immediate or Cancel</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>        <span class="n">order_time_mode</span><span class="o">=</span><span class="s2">&quot;GTC&quot;</span><span class="p">,</span>     <span class="c1"># Good Till Cancelled</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>        <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>             <span class="c1"># Set to True for testing</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;My buy order&quot;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="p">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    <span class="c1"># Place a SELL market order with FOK filling</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">place_market_order</span><span class="p">(</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="n">volume</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="n">order_side</span><span class="o">=</span><span class="s2">&quot;SELL&quot;</span><span class="p">,</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="n">order_filling_mode</span><span class="o">=</span><span class="s2">&quot;FOK&quot;</span><span class="p">,</span>  <span class="c1"># Fill or Kill</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>        <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Test mode</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>    <span class="p">)</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="stop-loss-and-take-profit-management">Stop Loss and Take Profit Management<a class="headerlink" href="#stop-loss-and-take-profit-management" title="Permanent link">&para;</a></h2>
<p>Update SL/TP for existing positions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="c1"># Update SL/TP for all EURUSD positions</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">update_sltp_for_open_positions</span><span class="p">(</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>        <span class="n">stop_loss</span><span class="o">=</span><span class="mf">1.0950</span><span class="p">,</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>        <span class="n">take_profit</span><span class="o">=</span><span class="mf">1.1100</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="c1"># Update only specific positions by ticket</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">update_sltp_for_open_positions</span><span class="p">(</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>        <span class="n">stop_loss</span><span class="o">=</span><span class="mf">1.0950</span><span class="p">,</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="n">tickets</span><span class="o">=</span><span class="p">[</span><span class="mi">123456</span><span class="p">,</span> <span class="mi">789012</span><span class="p">],</span>  <span class="c1"># Specific position tickets</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    <span class="p">)</span>
</code></pre></div>
<h2 id="market-data-and-analysis-methods">Market Data and Analysis Methods<a class="headerlink" href="#market-data-and-analysis-methods" title="Permanent link">&para;</a></h2>
<h3 id="spread-analysis">Spread Analysis<a class="headerlink" href="#spread-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="c1"># Calculate spread ratio for symbol</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">spread_ratio</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_spread_ratio</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EURUSD spread ratio: </span><span class="si">{</span><span class="n">spread_ratio</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="ohlc-data-retrieval">OHLC Data Retrieval<a class="headerlink" href="#ohlc-data-retrieval" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="c1"># Fetch latest rate data as DataFrame</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">rates_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_latest_rates_as_df</span><span class="p">(</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        <span class="n">granularity</span><span class="o">=</span><span class="s2">&quot;M1&quot;</span><span class="p">,</span>  <span class="c1"># 1-minute bars</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="n">count</span><span class="o">=</span><span class="mi">1440</span><span class="p">,</span>        <span class="c1"># Last 24 hours</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="s2">&quot;time&quot;</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="p">)</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latest rates: </span><span class="si">{</span><span class="n">rates_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="tick-data-analysis">Tick Data Analysis<a class="headerlink" href="#tick-data-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="c1"># Fetch recent tick data</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">ticks_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_latest_ticks_as_df</span><span class="p">(</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>        <span class="n">seconds</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>           <span class="c1"># Last 5 minutes</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="s2">&quot;time_msc&quot;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tick count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="position-analytics-with-enhanced-metrics">Position Analytics with Enhanced Metrics<a class="headerlink" href="#position-analytics-with-enhanced-metrics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="c1"># Get positions with additional calculated metrics</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch_positions_with_metrics_as_df</span><span class="p">(</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">)</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position metrics:&quot;</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total signed volume: </span><span class="si">{</span><span class="n">positions_df</span><span class="p">[</span><span class="s1">&#39;signed_volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total signed margin: </span><span class="si">{</span><span class="n">positions_df</span><span class="p">[</span><span class="s1">&#39;signed_margin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average profit ratio: </span><span class="si">{</span><span class="n">positions_df</span><span class="p">[</span><span class="s1">&#39;underlier_profit_ratio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="deal-history-analysis">Deal History Analysis<a class="headerlink" href="#deal-history-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">with</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="c1"># Collect entry deals for analysis</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="n">deals_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">collect_entry_deals_as_df</span><span class="p">(</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>        <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>        <span class="n">history_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>  <span class="c1"># Last hour</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>        <span class="n">index_keys</span><span class="o">=</span><span class="s2">&quot;ticket&quot;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="p">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">deals_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entry deals found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">deals_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deal types: </span><span class="si">{</span><span class="n">deals_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="integration-with-mt5dataclient">Integration with Mt5DataClient<a class="headerlink" href="#integration-with-mt5dataclient" title="Permanent link">&para;</a></h2>
<p>Since Mt5TradingClient inherits from Mt5DataClient, all data retrieval methods are available:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">with</span> <span class="n">Mt5TradingClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="c1"># Get current positions as DataFrame</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">positions_df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_positions_as_df</span><span class="p">()</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="c1"># Analyze positions</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">positions_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>        <span class="c1"># Calculate total exposure</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>        <span class="n">total_volume</span> <span class="o">=</span> <span class="n">positions_df</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        <span class="c1"># Close losing positions</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>        <span class="n">losing_positions</span> <span class="o">=</span> <span class="n">positions_df</span><span class="p">[</span><span class="n">positions_df</span><span class="p">[</span><span class="s1">&#39;profit&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">losing_positions</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>            <span class="n">client</span><span class="o">.</span><span class="n">close_open_positions</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    <span class="c1"># Risk management with margin calculations</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;EURUSD&quot;</span><span class="p">,</span> <span class="s2">&quot;GBPUSD&quot;</span><span class="p">,</span> <span class="s2">&quot;USDJPY&quot;</span><span class="p">]:</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        <span class="c1"># Calculate current margin usage</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="n">current_ratio</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_new_position_margin_ratio</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> current margin ratio: </span><span class="si">{</span><span class="n">current_ratio</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        <span class="c1"># Calculate maximum safe position size</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>        <span class="n">safe_margin</span> <span class="o">=</span> <span class="mf">500.0</span>  <span class="c1"># USD</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>        <span class="n">max_safe_volume</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">calculate_volume_by_margin</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">safe_margin</span><span class="p">,</span> <span class="s2">&quot;BUY&quot;</span><span class="p">)</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> max safe volume: </span><span class="si">{</span><span class="n">max_safe_volume</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
